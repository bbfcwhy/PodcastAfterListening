# Feature Specification: Library 收藏功能修復與單集收藏

**Feature Branch**: `008-library-episode-bookmarks`
**Created**: 2026-02-25
**Status**: Draft
**Input**: User description: "現在如果在逛Channels的時候，如果按收藏至library，再去Library那個頁面看，好像都不會看到已收藏的頻道。另外，我想要讓單集也可以被使用者單獨收藏，不一定要收藏整個頻道。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 修復 Library 頁面顯示已收藏頻道 (Priority: P1)

使用者在瀏覽頻道（Channels/Shows）時按下「收藏至 Library」按鈕後，前往 Library 頁面應能看到剛才收藏的頻道。目前使用者反映收藏後在 Library 頁面看不到已收藏的頻道，需要找出問題根因並修復。

**Why this priority**: 這是現有功能的 Bug，直接影響核心用戶體驗。使用者無法看到自己收藏的內容，會導致對平台信任度下降。

**Independent Test**: 登入後在頻道頁面點擊收藏，然後到 Library 頁面確認收藏的頻道正確顯示，包含頻道名稱、封面圖及描述。

**Acceptance Scenarios**:

1. **Given** 使用者已登入且 Library 為空, **When** 使用者在任一頻道頁面點擊「收藏至 Library」, **Then** Library 頁面立即顯示該收藏的頻道
2. **Given** 使用者已收藏多個頻道, **When** 使用者前往 Library 頁面, **Then** 所有已收藏的頻道按照收藏順序正確顯示
3. **Given** 使用者已收藏一個頻道, **When** 使用者在 Library 或頻道頁面點擊「取消收藏」, **Then** 該頻道從 Library 頁面中移除

---

### User Story 2 - 單集收藏功能 (Priority: P2)

使用者在瀏覽單集（Episode）詳情頁面時，可以獨立收藏該單集，不需要收藏整個頻道。收藏的單集會出現在 Library 頁面中，與收藏的頻道一起呈現。

**Why this priority**: 這是使用者明確提出的新需求，讓使用者可以更精細地管理自己感興趣的內容，提升平台黏著度。

**Independent Test**: 登入後在單集頁面點擊收藏按鈕，然後到 Library 頁面確認該單集出現在收藏列表中。

**Acceptance Scenarios**:

1. **Given** 使用者已登入且瀏覽某一單集頁面, **When** 使用者點擊「收藏單集」按鈕, **Then** 該單集被加入 Library 並顯示收藏成功的視覺回饋
2. **Given** 使用者已收藏某單集, **When** 使用者再次瀏覽該單集頁面, **Then** 按鈕顯示「已收藏」狀態
3. **Given** 使用者已收藏某單集, **When** 使用者點擊「取消收藏」, **Then** 該單集從 Library 中移除

---

### User Story 3 - Library 頁面分類顯示 (Priority: P3)

Library 頁面需要能夠區分顯示已收藏的頻道和已收藏的單集，讓使用者能快速找到想要的內容。

**Why this priority**: 當使用者同時收藏頻道和單集後，需要清晰的分類才能有效管理收藏內容。

**Independent Test**: 在 Library 頁面切換頻道和單集分類，確認各自的收藏內容正確顯示。

**Acceptance Scenarios**:

1. **Given** 使用者已收藏頻道和單集, **When** 使用者前往 Library 頁面, **Then** 頁面提供分類切換（例如「頻道」和「單集」分頁）
2. **Given** 使用者在 Library 頁面, **When** 使用者切換到「單集」分類, **Then** 只顯示已收藏的單集，包含單集名稱、所屬頻道及發佈日期
3. **Given** 使用者在 Library 頁面, **When** 使用者切換到「頻道」分類, **Then** 只顯示已收藏的頻道，並可繼續拖曳排序

---

### Edge Cases

- 使用者收藏某頻道後，該頻道被管理員刪除時，Library 頁面應正常顯示（不因此出錯），已刪除頻道的收藏項目應被過濾掉
- 使用者收藏某單集後，該單集所屬頻道被刪除時，收藏的單集仍應可見（顯示頻道名稱為「已移除的頻道」或類似提示）
- 使用者未登入時點擊收藏按鈕，應引導使用者登入
- 同一使用者不能重複收藏同一單集
- 使用者收藏某單集後，該單集被管理員刪除時，Library 頁面應正常顯示，已刪除單集的收藏項目應被過濾掉
- 使用者收藏頻道不代表自動收藏該頻道的所有單集，兩者獨立運作

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系統必須在 Library 頁面正確顯示使用者已收藏的所有頻道
- **FR-002**: 系統必須允許使用者在單集頁面獨立收藏或取消收藏單一單集
- **FR-003**: 系統必須在 Library 頁面同時展示已收藏的頻道和單集，並提供分類切換
- **FR-004**: 系統必須在收藏/取消收藏操作後立即更新畫面狀態（樂觀更新）
- **FR-005**: 系統必須防止使用者重複收藏同一單集（唯一性約束）
- **FR-006**: 系統必須僅允許已登入使用者進行收藏操作
- **FR-007**: 頻道收藏與單集收藏必須完全獨立——收藏頻道不會自動收藏其下所有單集
- **FR-008**: 收藏的單集必須顯示所屬頻道名稱，方便使用者辨識來源
- **FR-009**: Library 頁面的頻道列表必須維持現有的拖曳排序功能

### Key Entities

- **Library Item (Show)**: 使用者與頻道的收藏關係，包含收藏順序和收藏時間
- **Library Item (Episode)**: 使用者與單集的收藏關係，包含收藏時間及所屬頻道資訊
- **Show (頻道)**: Podcast 頻道，包含名稱、封面圖、描述
- **Episode (單集)**: 頻道下的單一集數，包含標題、發佈日期、所屬頻道

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 使用者收藏頻道後，在 Library 頁面 100% 能看到已收藏的頻道（修復現有 Bug）
- **SC-002**: 使用者能在 2 次點擊內完成單集收藏操作（點擊收藏按鈕 → 看到收藏成功回饋）
- **SC-003**: Library 頁面載入時間不因新增單集收藏功能而明顯增加（與現有體驗一致）
- **SC-004**: 收藏與取消收藏操作的視覺回饋在 1 秒內呈現

## Clarifications

### Session 2026-02-25

- Q: 單集收藏按鈕的出現位置？ → A: 僅限單集詳情頁（與現有頻道收藏按鈕模式一致）

## Assumptions

- 目前 Library 頁面不顯示頻道的問題為既有 Bug，可能與資料查詢、頁面快取或元件渲染邏輯有關，需在實作階段進一步調查
- 單集收藏需要新增一個獨立的資料儲存機制（與現有的頻道收藏分開）
- 單集收藏不需要支援拖曳排序（依收藏時間倒序排列即可）
- 單集收藏按鈕的 UI 風格與現有頻道收藏按鈕一致
- Library 頁面的分類切換採用分頁（Tab）設計，預設顯示「頻道」分頁

## Scope

### In Scope

- 修復 Library 頁面不顯示已收藏頻道的 Bug
- 新增單集收藏/取消收藏功能
- Library 頁面新增分類切換（頻道 vs 單集）
- 單集收藏按鈕僅出現在單集詳情頁面（與頻道收藏按鈕模式一致）

### Out of Scope

- 收藏夾/播放清單功能
- 收藏內容分享功能
- 在頻道列表頁直接收藏（僅限頻道詳情頁和單集詳情頁）
- 收藏的匯入/匯出
- 收藏數量統計或排行
